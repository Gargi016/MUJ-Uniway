<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>MUJ UniWay - Interactive Campus Map</title>
 
 <script src="https://cdn.tailwindcss.com"></script>
 
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
 
 <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />

 <style>
 /* --- Enhanced "Pretty" Styles --- */
 :root {
 --primary-color: #f59e0b; /* amber-500 */
 --primary-hover: #d97706; /* amber-600 */
 --dark-bg: #1e293b; /* slate-800 */
 --light-bg: #f8fafc; /* slate-50 */
 --text-dark: #334155; /* slate-700 */
 --text-light: #cbd5e1; /* slate-300 */
 --border-color: #e2e8f0; /* slate-200 */
 }

 body {
 font-family: 'Inter', sans-serif;
 overflow: hidden;
 -webkit-font-smoothing: antialiased;
 -moz-osx-font-smoothing: grayscale;
 }

 #map {
 height: 100%;
 width: 100%;
 z-index: 10;
 }
 
 .leaflet-marker-icon svg {
 filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
 }

 .custom-scrollbar::-webkit-scrollbar {
 width: 8px;
 }
 .custom-scrollbar::-webkit-scrollbar-track {
 background: #f1f5f9;
 }
 .custom-scrollbar::-webkit-scrollbar-thumb {
 background: #cbd5e1;
 border-radius: 4px;
 }
 .custom-scrollbar::-webkit-scrollbar-thumb:hover {
 background: #94a3b8;
 }

 @keyframes fadeIn {
 from { opacity: 0; transform: translateY(10px); }
 to { opacity: 1; transform: translateY(0); }
 }
 .info-panel-visible {
 animation: fadeIn 0.4s ease-out forwards;
 }
 
 /* Style the routing machine instructions panel */
 .leaflet-routing-container {
 background-color: white;
 padding: 1rem;
 border-radius: 0.5rem;
 box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
 max-height: 50vh;
 overflow-y: auto;
 }
 </style>
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-100">

 <div class="flex flex-col md:flex-row h-screen">
 <aside class="w-full md:w-96 bg-white shadow-xl flex flex-col z-20 h-1/2 md:h-screen">
 <header class="p-4 border-b border-slate-200 bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-md">
 <h1 class="text-2xl font-bold">MUJ UniWay</h1>
 <p class="text-sm text-slate-300">Your Campus Navigation Assistant</p>
 </header>

 <div class="flex-grow p-4 overflow-y-auto custom-scrollbar">
 <section class="mb-6">
 <h2 class="text-lg font-semibold text-slate-700 mb-3">Find a Location</h2>
 <div class="relative flex items-center">
 <svg class="w-5 h-5 absolute left-3 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
 <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
 </svg>
 <input type="text" id="searchInput" placeholder="e.g., Academic Block 1" class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition-all duration-300">
 <div id="searchResults" class="absolute w-full bg-white border border-slate-200 rounded-lg mt-1 top-full shadow-lg z-30 max-h-48 overflow-y-auto"></div>
 </div>
 </section>

 <section class="mb-6">
 <h2 class="text-lg font-semibold text-slate-700 mb-3">Categories</h2>
 <div id="categoryFilters" class="flex flex-wrap gap-2">
 </div>
 </section>

<section>
        <h2 class="text-lg font-semibold text-slate-700 mb-3">Plan Your Route</h2>
        <div class="space-y-3">
            <button id="routeFromCurrentLocation" class="w-full bg-amber-500 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-amber-600 transition-all duration-300 shadow hover:shadow-lg transform hover:scale-105 active:scale-100">
                Route from My Location
            </button>
            <button id="clearRouteButton" class="w-full bg-slate-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-slate-700 transition-all duration-300 shadow hover:shadow-lg transform hover:scale-105 active:scale-100" style="display: none;">
                Clear Route
            </button>
        </div>
    </section>

   <section class="mt-6">
        <h2 class="text-lg font-semibold text-slate-700 mb-3">Emergency</h2>
        <div class="space-y-3">
            <button id="sosButton" class="w-full flex items-center justify-center gap-2 bg-red-600 text-white font-extrabold tracking-wider py-3 px-4 rounded-lg hover:bg-red-700 transition-all duration-300 shadow-lg transform hover:scale-105 active:scale-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                EMERGENCY SOS
            </button>
            <button id="clearSosButton" class="w-full bg-slate-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-slate-700 transition-all duration-300 shadow hover:shadow-lg" style="display: none;">
                Clear SOS Alert
            </button>
        </div>
    </section>

    <section class="mt-6">
        <h2 class="text-lg font-semibold text-slate-700 mb-3">Lost & Found</h2>
        <div id="lostAndFoundList" class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar p-2 bg-slate-50 rounded-lg">
            </div>
    </section>
    
 <section id="infoPanel" class="mt-6 p-4 bg-slate-50 rounded-lg border-l-4 border-amber-500 shadow-md">
 <h3 id="infoName" class="text-xl font-bold text-slate-800"></h3>
 <p id="infoCategory" class="text-sm font-medium text-amber-800 bg-amber-100 inline-block px-2 py-0.5 rounded-full my-2"></p>
 <p class="text-slate-600"><strong class="font-semibold">Status:</strong> <span id="infoStatus"></span></p>
 <p class="text-slate-600"><strong class="font-semibold">Hours:</strong> <span id="infoHours"></span></p>
 </section>
 </div>
 </aside>

 <main id="map" class="flex-grow h-1/2 md:h-screen"></main>
 </div>

 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
 <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

 <script>
 // --- DATA CORE (MERGED & CORRECTED) ---
 const rawGeojsonData = {
 "type": "FeatureCollection",
 "features": [{
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.5642164173488, 26.84468864902938],
 [75.56422584399374, 26.84468864902938],
 [75.56422584399374, 26.844688649459542],
 [75.5642164173488, 26.844688649459542],
 [75.5642164173488, 26.84468864902938]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Lecture Hall Complex",
 "category": "Academic",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56422416998598, 26.844688995537936],
 [75.56471741055049, 26.843566321753983],
 [75.56481136113518, 26.843485488811865],
 [75.56526769254222, 26.843641167018745],
 [75.56473418744037, 26.84487760364135],
 [75.56422416998598, 26.844688995537936]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Academic Block 3",
 "category": "Academic",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56355568200081, 26.84448580854037],
 [75.56365249061594, 26.844212807665954],
 [75.56395498791437, 26.844309619391325],
 [75.56390237968816, 26.844380027867743],
 [75.56396813997094, 26.844400563664365],
 [75.56405034032304, 26.84420107290562],
 [75.5637741471387, 26.84410132739491],
 [75.56390237968816, 26.84384609583296],
 [75.56418186088743, 26.843939974175186],
 [75.5642967739847, 26.843655057070634],
 [75.56422314886439, 26.84363797102509],
 [75.56416725262434, 26.843743584348914],
 [75.56378584298767, 26.84361450138495],
 [75.56389105943893, 26.843391539553735],
 [75.56458154240181, 26.843623302500205],
 [75.5641179324131, 26.844679431441364],
 [75.56355568200081, 26.84448580854037]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Old Mess",
 "category": "Dining",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.5648691729159, 26.843344104977874],
 [75.56521585407506, 26.84252057611822],
 [75.56567059170041, 26.842677247923433],
 [75.5653194081874, 26.843492741255602],
 [75.5648691729159, 26.843344104977874]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Grand Stairs",
 "category": "Events",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.5652302178145, 26.84251057584467],
 [75.56530901231929, 26.842340875249178],
 [75.56574374062441, 26.842493605796278],
 [75.56566766317124, 26.84266330616282],
 [75.5652302178145, 26.84251057584467]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.56550919677687, 26.843560452317973],
 [75.5655701799038, 26.843446682231573],
 [75.56571432183819, 26.843142470351765],
 [75.56575590124095, 26.84306579893584],
 [75.56575312928086, 26.84298170764552],
 [75.56594716650011, 26.842543937274442],
 [75.56695061611686, 26.842897616293556],
 [75.56649047071309, 26.843919074668648],
 [75.56550919677687, 26.843560452317973]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Academic Block 1",
 "category": "Academic",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56382400124235, 26.8429574268429],
 [75.56378067463936, 26.8429488361638],
 [75.56422356880387, 26.841909359190325],
 [75.5651382415328, 26.842227216798676],
 [75.56471460363639, 26.843262395526466],
 [75.56382400124235, 26.8429574268429]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Football Ground",
 "category": "Sports",
 "status": "Open",
 "hours": "6:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56491962922675, 26.844781779741737],
 [75.56537407762369, 26.843753255739173],
 [75.56586732043564, 26.84393621501316],
 [75.56540178793134, 26.844944958167076],
 [75.56491962922675, 26.844781779741737]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Basketball Court",
 "category": "Sports",
 "status": "Open",
 "hours": "6:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56486523737334, 26.84636296052632],
 [75.56485835818765, 26.84611131240551],
 [75.56566322297599, 26.84614813899509],
 [75.56564946460333, 26.846399787034045],
 [75.56486523737334, 26.84636296052632]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Tennis Court",
 "category": "Sports",
 "status": "Open",
 "hours": "6:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56503490024289, 26.845964976458944],
 [75.56506784959373, 26.845690592961688],
 [75.5658147015601, 26.845700392383833],
 [75.5658037184437, 26.846004174046655],
 [75.56503490024289, 26.845964976458944]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Cricket Ground",
 "category": "Sports",
 "status": "Open",
 "hours": "6:00 AM - 9:00 PM"
 },
 "geometry": {
 "type": "Polygon",
 "coordinates": [
 [
 [75.564178, 26.846205],
 [75.564099, 26.846201],
 [75.56402, 26.846191],
 [75.563943, 26.846174],
 [75.563869, 26.84615],
 [75.563797, 26.84612],
 [75.563729, 26.846083],
 [75.563666, 26.846041],
 [75.563607, 26.845994],
 [75.563554, 26.845941],
 [75.563507, 26.845884],
 [75.563466, 26.845824],
 [75.563432, 26.84576],
 [75.563405, 26.845693],
 [75.563386, 26.845625],
 [75.563374, 26.845555],
 [75.56337, 26.845484],
 [75.563374, 26.845414],
 [75.563386, 26.845344],
 [75.563405, 26.845275],
 [75.563432, 26.845209],
 [75.563466, 26.845145],
 [75.563507, 26.845084],
 [75.563554, 26.845027],
 [75.563607, 26.844975],
 [75.563666, 26.844928],
 [75.563729, 26.844885],
 [75.563797, 26.844849],
 [75.563869, 26.844819],
 [75.563943, 26.844795],
 [75.56402, 26.844778],
 [75.564099, 26.844768],
 [75.564178, 26.844764],
 [75.564257, 26.844768],
 [75.564335, 26.844778],
 [75.564412, 26.844795],
 [75.564487, 26.844819],
 [75.564558, 26.844849],
 [75.564626, 26.844885],
 [75.56469, 26.844928],
 [75.564749, 26.844975],
 [75.564802, 26.845027],
 [75.564849, 26.845084],
 [75.56489, 26.845145],
 [75.564924, 26.845209],
 [75.56495, 26.845275],
 [75.564969, 26.845344],
 [75.564981, 26.845414],
 [75.564985, 26.845484],
 [75.564981, 26.845555],
 [75.564969, 26.845625],
 [75.56495, 26.845693],
 [75.564924, 26.84576],
 [75.56489, 26.845824],
 [75.564849, 26.845884],
 [75.564802, 26.845941],
 [75.564749, 26.845994],
 [75.56469, 26.846041],
 [75.564626, 26.846083],
 [75.564558, 26.84612],
 [75.564487, 26.84615],
 [75.564412, 26.846174],
 [75.564335, 26.846191],
 [75.564257, 26.846201],
 [75.564178, 26.846205]
 ]
 ]
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Jungle",
 "category": "No access",
 "status": "Closed"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56564, 26.844694],
 [75.565976, 26.843932],
 [75.567122, 26.844337],
 [75.566776, 26.8451],
 [75.56564, 26.844694]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Workshop Building",
 "category": "Academic",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.566654, 26.844039],
 [75.566947, 26.84335],
 [75.567159, 26.843426],
 [75.567121, 26.843502],
 [75.566943, 26.84344],
 [75.566924, 26.843474],
 [75.567113, 26.843536],
 [75.566878, 26.844111],
 [75.566654, 26.844039]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Automobile Workshop",
 "category": "Academic",
 "status": "Open",
 "hours": "8:00 AM - 6:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.567258, 26.843602],
 [75.567442, 26.843516],
 [75.567494, 26.843602],
 [75.567407, 26.843649],
 [75.567459, 26.843735],
 [75.567363, 26.843751],
 [75.567258, 26.843602]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Volleyball Court",
 "category": "Sports",
 "status": "Open",
 "hours": "6:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.565122, 26.845547],
 [75.565122, 26.84536],
 [75.565678, 26.845369],
 [75.565668, 26.845574],
 [75.565122, 26.845547]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Great Grand Staircase"
 },
 "geometry": {
 "coordinates": [
 [
 [75.564813, 26.843512],
 [75.564885, 26.843311],
 [75.565321, 26.843463],
 [75.565244, 26.84366],
 [75.564813, 26.843512]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Bluedove Mess",
 "category": "Dining",
 "status": "Open",
 "hours": "8:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561581, 26.840575],
 [75.561748, 26.840133],
 [75.562022, 26.840235],
 [75.561824, 26.840663],
 [75.561581, 26.840575]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G7",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.56127, 26.839931],
 [75.561311, 26.839808],
 [75.561763, 26.839955],
 [75.561713, 26.840071],
 [75.56127, 26.839931]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G6",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM- 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561326, 26.83978],
 [75.561347, 26.839713],
 [75.561671, 26.839818],
 [75.561716, 26.839713],
 [75.56184, 26.839751],
 [75.561767, 26.839922],
 [75.561326, 26.83978]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G5",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561358, 26.839686],
 [75.561422, 26.839473],
 [75.561902, 26.83962],
 [75.561859, 26.839713],
 [75.561605, 26.839629],
 [75.561563, 26.839751],
 [75.561358, 26.839686]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G8",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562386, 26.840183],
 [75.562492, 26.839933],
 [75.562141, 26.839827],
 [75.562237, 26.839600],
 [75.562803, 26.839776],
 [75.562755, 26.839866],
 [75.562584, 26.840258],
 [75.562386, 26.840183]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G4",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562043, 26.840635],
 [75.562158, 26.840298],
 [75.562273, 26.840321],
 [75.562177, 26.840572],
 [75.562446, 26.840646],
 [75.562408, 26.840743],
 [75.562043, 26.840635]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G2",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562495, 26.840774],
 [75.562647, 26.840423],
 [75.562765, 26.840471],
 [75.562659, 26.840726],
 [75.562933, 26.840818],
 [75.562876, 26.84092],
 [75.562495, 26.840774]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G3",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562846, 26.840681],
 [75.562961, 26.840454],
 [75.562703, 26.840365],
 [75.562741, 26.840275],
 [75.563109, 26.840407],
 [75.562971, 26.840732],
 [75.562846, 26.840681]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "G1",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562961, 26.840934],
 [75.563112, 26.840536],
 [75.563332, 26.840603],
 [75.563415, 26.840425],
 [75.563559, 26.840456],
 [75.563463, 26.840658],
 [75.56371, 26.840744],
 [75.563752, 26.840671],
 [75.563683, 26.840634],
 [75.563703, 26.840566],
 [75.563841, 26.840615],
 [75.563738, 26.840879],
 [75.563662, 26.840842],
 [75.5636, 26.840996],
 [75.563518, 26.841155],
 [75.562961, 26.840934]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Laundry",
 "category": "Amenities",
 "status": "Open",
 "hours": "10:00 AM - 7:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561317, 26.840057],
 [75.561662, 26.840176],
 [75.561515, 26.840488],
 [75.561381, 26.840422],
 [75.56128, 26.840135],
 [75.561317, 26.840057]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "INDYA FOODS (Blu spring)",
 "category": "Dining",
 "status": "Open",
 "hours": "7:30 AM-10:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561482, 26.840963],
 [75.561877, 26.84109],
 [75.561694, 26.841529],
 [75.561305, 26.841402],
 [75.561482, 26.840963]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B7",
 "category": "Hostel",
 "status": "open",
 "hours": "6:00 AM-11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561562, 26.84176],
 [75.561507, 26.841904],
 [75.560986, 26.841737],
 [75.560879, 26.842001],
 [75.56142, 26.842173],
 [75.561382, 26.842268],
 [75.560733, 26.842061],
 [75.560917, 26.841602],
 [75.561138, 26.841673],
 [75.561155, 26.84163],
 [75.561562, 26.84176]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B5",
 "category": "Hostel",
 "hours": "6:00 AM-11:00 PM",
 "status": "Open"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561759, 26.841821],
 [75.561845, 26.841646],
 [75.561891, 26.841658],
 [75.56192, 26.841617],
 [75.562174, 26.841704],
 [75.562036, 26.841997],
 [75.561931, 26.841969],
 [75.562022, 26.841767],
 [75.561936, 26.84173],
 [75.561868, 26.841856],
 [75.561759, 26.841821]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B4",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561978, 26.8411],
 [75.562278, 26.841208],
 [75.562248, 26.841277],
 [75.562289, 26.841292],
 [75.562152, 26.841596],
 [75.562099, 26.841579],
 [75.562093, 26.841592],
 [75.561879, 26.841515],
 [75.561902, 26.841466],
 [75.561843, 26.841444],
 [75.561927, 26.841257],
 [75.56203, 26.841292],
 [75.561976, 26.841424],
 [75.562083, 26.841464],
 [75.562164, 26.841288],
 [75.561933, 26.841207],
 [75.561978, 26.8411]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B3",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562404, 26.841252],
 [75.562709, 26.841362],
 [75.562568, 26.841673],
 [75.562582, 26.841681],
 [75.562551, 26.84175],
 [75.562533, 26.841746],
 [75.562494, 26.841825],
 [75.562425, 26.841798],
 [75.562459, 26.841718],
 [75.562244, 26.841634],
 [75.562292, 26.841534],
 [75.562489, 26.841605],
 [75.562556, 26.841459],
 [75.562459, 26.841427],
 [75.562418, 26.841504],
 [75.562305, 26.841467],
 [75.562404, 26.841252]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "dome": "Adminstration",
 "category": "Office",
 "status": "Open",
 "hours": "10:00 AM - 5:00 PM"
 },
 "geometry": {
 "type": "Polygon",
 "coordinates": [
 [
 [75.565918, 26.841837],
 [75.565895, 26.841836],
 [75.565872, 26.841833],
 [75.565849, 26.841828],
 [75.565827, 26.841821],
 [75.565806, 26.841812],
 [75.565786, 26.841801],
 [75.565768, 26.841789],
 [75.565751, 26.841775],
 [75.565735, 26.84176],
 [75.565721, 26.841743],
 [75.565709, 26.841725],
 [75.565699, 26.841706],
 [75.565691, 26.841687],
 [75.565686, 26.841667],
 [75.565682, 26.841646],
 [75.565681, 26.841625],
 [75.565682, 26.841605],
 [75.565686, 26.841584],
 [75.565691, 26.841564],
 [75.565699, 26.841544],
 [75.565709, 26.841526],
 [75.565721, 26.841508],
 [75.565735, 26.841491],
 [75.565751, 26.841476],
 [75.565768, 26.841462],
 [75.565786, 26.84145],
 [75.565806, 26.841439],
 [75.565827, 26.84143],
 [75.565849, 26.841423],
 [75.565872, 26.841418],
 [75.565895, 26.841415],
 [75.565918, 26.841414],
 [75.565941, 26.841415],
 [75.565964, 26.841418],
 [75.565987, 26.841423],
 [75.566009, 26.84143],
 [75.56603, 26.841439],
 [75.56605, 26.84145],
 [75.566068, 26.841462],
 [75.566086, 26.841476],
 [75.566101, 26.841491],
 [75.566115, 26.841508],
 [75.566127, 26.841526],
 [75.566137, 26.841544],
 [75.566145, 26.841564],
 [75.566151, 26.841584],
 [75.566154, 26.841605],
 [75.566155, 26.841625],
 [75.566154, 26.841646],
 [75.566151, 26.841667],
 [75.566145, 26.841687],
 [75.566137, 26.841706],
 [75.566127, 26.841725],
 [75.566115, 26.841743],
 [75.566101, 26.84176],
 [75.566086, 26.841775],
 [75.566068, 26.841789],
 [75.56605, 26.841801],
 [75.56603, 26.841812],
 [75.566009, 26.841821],
 [75.565987, 26.841828],
 [75.565964, 26.841833],
 [75.565941, 26.841836],
 [75.565918, 26.841837]
 ]
 ]
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Central Library",
 "category": "Library",
 "status": "Open",
 "hours": "9:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.565004, 26.841626],
 [75.565026, 26.841347],
 [75.565098, 26.841352],
 [75.5651, 26.841372],
 [75.565762, 26.84143],
 [75.565622, 26.84166],
 [75.565082, 26.841619],
 [75.565081, 26.841633],
 [75.565004, 26.841626]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "IT office",
 "category": "Office",
 "status": "Open",
 "hours": "11:00 AM - 4:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.566577, 26.842156],
 [75.566522, 26.842127],
 [75.566528, 26.842112],
 [75.566099, 26.841826],
 [75.566191, 26.841567],
 [75.566706, 26.841916],
 [75.566724, 26.841908],
 [75.566772, 26.841939],
 [75.566577, 26.842156]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.565894, 26.841414],
 [75.565922, 26.841337],
 [75.566156, 26.841414],
 [75.566135, 26.84148],
 [75.565894, 26.841414]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "parking",
 "category": "Parking"
 },
 "geometry": {
 "coordinates": [
 [
 [75.564335, 26.841337],
 [75.564591, 26.840759],
 [75.564925, 26.84089],
 [75.564669, 26.841442],
 [75.564335, 26.841337]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Parking",
 "category": "Parking"
 },
 "geometry": {
 "coordinates": [
 [
 [75.563478, 26.842453],
 [75.56357, 26.84225],
 [75.563641, 26.842276],
 [75.563726, 26.842125],
 [75.563873, 26.842183],
 [75.563713, 26.842538],
 [75.563478, 26.842453]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B1",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 am-11:00 pm"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562796, 26.841385],
 [75.562979, 26.841444],
 [75.562997, 26.841381],
 [75.563208, 26.84146],
 [75.563155, 26.841584],
 [75.563106, 26.841566],
 [75.56303, 26.841739],
 [75.563192, 26.841795],
 [75.563153, 26.841893],
 [75.563123, 26.841879],
 [75.563073, 26.841994],
 [75.563087, 26.841997],
 [75.562962, 26.842302],
 [75.562584, 26.842179],
 [75.56263, 26.84207],
 [75.56289, 26.842157],
 [75.562934, 26.842061],
 [75.562977, 26.842079],
 [75.56304, 26.841915],
 [75.562967, 26.841888],
 [75.562902, 26.842037],
 [75.562839, 26.842019],
 [75.562816, 26.842073],
 [75.562567, 26.841987],
 [75.562612, 26.841891],
 [75.56278, 26.841947],
 [75.562815, 26.841852],
 [75.562674, 26.841805],
 [75.562705, 26.841724],
 [75.562663, 26.841705],
 [75.562796, 26.841385]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B2",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM- 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562022, 26.842278],
 [75.562258, 26.841699],
 [75.562381, 26.841742],
 [75.562329, 26.841871],
 [75.562459, 26.841911],
 [75.562448, 26.841942],
 [75.562501, 26.841958],
 [75.562426, 26.842157],
 [75.562459, 26.842169],
 [75.5624, 26.842292],
 [75.562497, 26.842325],
 [75.562527, 26.842244],
 [75.562648, 26.842279],
 [75.562594, 26.842392],
 [75.562753, 26.842443],
 [75.562803, 26.842325],
 [75.562922, 26.842366],
 [75.56283, 26.842602],
 [75.562548, 26.842517],
 [75.56256, 26.84246],
 [75.562255, 26.842352],
 [75.562354, 26.842121],
 [75.562342, 26.842112],
 [75.56235, 26.842092],
 [75.562322, 26.842081],
 [75.562372, 26.841962],
 [75.562291, 26.841934],
 [75.562134, 26.842316],
 [75.562022, 26.842278]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B6",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM- 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.562007, 26.842077],
 [75.561964, 26.842175],
 [75.561756, 26.842099],
 [75.561689, 26.84225],
 [75.562219, 26.842442],
 [75.56218, 26.842539],
 [75.561623, 26.842344],
 [75.561621, 26.84236],
 [75.561566, 26.842341],
 [75.56159, 26.842294],
 [75.561555, 26.842274],
 [75.561717, 26.84191],
 [75.561832, 26.841955],
 [75.561793, 26.842043],
 [75.561859, 26.84207],
 [75.561877, 26.84203],
 [75.562007, 26.842077]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.56063, 26.841652],
 [75.560641, 26.841619],
 [75.560623, 26.841613],
 [75.560708, 26.841418],
 [75.560797, 26.84145],
 [75.560728, 26.84159],
 [75.560745, 26.84161],
 [75.56071, 26.841675],
 [75.56063, 26.841652]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.560684, 26.841405],
 [75.560745, 26.84128],
 [75.560698, 26.841258],
 [75.560742, 26.841171],
 [75.560723, 26.84116],
 [75.560745, 26.841101],
 [75.560919, 26.841173],
 [75.560794, 26.841442],
 [75.560684, 26.841405]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.560877, 26.841146],
 [75.56075, 26.841095],
 [75.56082, 26.840941],
 [75.560955, 26.840988],
 [75.560932, 26.841031],
 [75.560838, 26.841001],
 [75.56081, 26.841071],
 [75.560899, 26.8411],
 [75.560877, 26.841146]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Taxi Services",
 "category": "Transport",
 "status": "open",
 "hours": "10:00 AM- 7:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.563228, 26.842061],
 [75.563174, 26.842037],
 [75.563316, 26.841773],
 [75.563369, 26.841802],
 [75.563228, 26.842061]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "cctv room",
 "category": "survelience",
 "status": "open"
 },
 "geometry": {
 "coordinates": [
 [
 [75.563541, 26.842183],
 [75.563559, 26.842151],
 [75.56361, 26.842179],
 [75.563593, 26.842203],
 [75.563541, 26.842183]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "subway entry-exit",
 "category": "Passway",
 "status": "Open",
 "hours": "7:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.563673, 26.842043],
 [75.563626, 26.842022],
 [75.563653, 26.84198],
 [75.563697, 26.841997],
 [75.563673, 26.842043]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Sports Complex",
 "category": "Sports",
 "status": "Open",
 "hours": "11:00 AM-11:00 PM",
 "floor": "ground and first- indoor second - turf"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561113, 26.841773],
 [75.561165, 26.841644],
 [75.56156, 26.841773],
 [75.561508, 26.841903],
 [75.561113, 26.841773]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {},
 "geometry": {
 "coordinates": [
 [
 [75.560889, 26.842172],
 [75.561334, 26.842325],
 [75.561252, 26.842492],
 [75.560797, 26.842378],
 [75.560889, 26.842172]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B10",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561376, 26.842355],
 [75.561765, 26.842484],
 [75.561718, 26.842565],
 [75.561478, 26.842475],
 [75.561384, 26.842605],
 [75.561275, 26.842563],
 [75.561376, 26.842355]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B8",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561787, 26.842499],
 [75.562067, 26.842587],
 [75.56201, 26.842671],
 [75.561742, 26.842574],
 [75.561787, 26.842499]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B9",
 "category": "Hostel",
 "status": "Open",
 "hours": "6:00 AM - 11:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561463, 26.842634],
 [75.561515, 26.842528],
 [75.561631, 26.842563],
 [75.561606, 26.842616],
 [75.56174, 26.842669],
 [75.561762, 26.842609],
 [75.561866, 26.842647],
 [75.561789, 26.842753],
 [75.561463, 26.842634]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Water Reservoir",
 "category": "No access"
 
 
 },
 "geometry": {
 "coordinates": [
 [
 [75.561814, 26.842808],
 [75.561886, 26.842669],
 [75.56201, 26.842709],
 [75.561953, 26.842846],
 [75.561814, 26.842808]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B11",
 "category": "Hostel",
 "status": "Closed"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561151, 26.842796],
 [75.561203, 26.84267],
 [75.561742, 26.84285],
 [75.561702, 26.842983],
 [75.561151, 26.842796]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "B12",
 "category": "Hostel",
 "status": "Closed"
 },
 "geometry": {
 "coordinates": [
 [
 [75.561139, 26.842868],
 [75.561706, 26.843047],
 [75.561783, 26.842871],
 [75.561944, 26.842918],
 [75.561867, 26.843097],
 [75.561807, 26.843241],
 [75.561078, 26.843047],
 [75.561139, 26.842868]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Subway",
 "category": "Passway",
 "status": "Open",
 "hours": "7:00 AM - 9:00 PM"
 },
 "geometry": {
 "coordinates": [
 [
 [75.563209, 26.841976],
 [75.563262, 26.842000],
 [75.563222, 26.842062],
 [75.563175, 26.84204],
 [75.563209, 26.841976]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Water Treatment"
 },
 "geometry": {
 "coordinates": [
 [
 [75.560979, 26.841211],
 [75.56108, 26.841002],
 [75.561152, 26.841032],
 [75.561127, 26.841092],
 [75.56121, 26.841135],
 [75.561147, 26.841276],
 [75.560979, 26.841211]
 ]
 ],
 "type": "Polygon"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Mess",
 "category": "No access",
 "status": "Under Construction"
 },
 "geometry": {
 "type": "Polygon",
 "coordinates": [
 [
 [75.561836, 26.842603],
 [75.561835, 26.842603],
 [75.561834, 26.842603],
 [75.561833, 26.842603],
 [75.561831, 26.842602],
 [75.56183, 26.842602],
 [75.561829, 26.842601],
 [75.561829, 26.842601],
 [75.561828, 26.842600],
 [75.561827, 26.842599],
 [75.561826, 26.842599],
 [75.561826, 26.842598],
 [75.561825, 26.842597],
 [75.561825, 26.842596],
 [75.561825, 26.842595],
 [75.561824, 26.842594],
 [75.561824, 26.842593],
 [75.561824, 26.842592],
 [75.561825, 26.842591],
 [75.561825, 26.84259],
 [75.561825, 26.842589],
 [75.561826, 26.842588],
 [75.561826, 26.842587],
 [75.561827, 26.842586],
 [75.561828, 26.842586],
 [75.561829, 26.842585],
 [75.561829, 26.842584],
 [75.56183, 26.842584],
 [75.561831, 26.842583],
 [75.561833, 26.842583],
 [75.561834, 26.842583],
 [75.561835, 26.842583],
 [75.561836, 26.842583],
 [75.561837, 26.842583],
 [75.561838, 26.842583],
 [75.561839, 26.842583],
 [75.56184, 26.842583],
 [75.561841, 26.842584],
 [75.561842, 26.842584],
 [75.561843, 26.842585],
 [75.561844, 26.842586],
 [75.561845, 26.842586],
 [75.561845, 26.842587],
 [75.561846, 26.842588],
 [75.561847, 26.842589],
 [75.561847, 26.84259],
 [75.561847, 26.842591],
 [75.561847, 26.842592],
 [75.561847, 26.842593],
 [75.561847, 26.842594],
 [75.561847, 26.842595],
 [75.561847, 26.842596],
 [75.561847, 26.842597],
 [75.561846, 26.842598],
 [75.561845, 26.842599],
 [75.561845, 26.842599],
 [75.561844, 26.8426],
 [75.561843, 26.842601],
 [75.561842, 26.842601],
 [75.561841, 26.842602],
 [75.56184, 26.842602],
 [75.561839, 26.842603],
 [75.561838, 26.842603],
 [75.561837, 26.842603],
 [75.561836, 26.842603]
 ]
 ]
 }
 },
{
 "type": "Feature",
 "properties": {
 "name": "Lost ID Card",
 "category": "Lost & Found",
 "status": "Lost since Aug 17",
 "hours": "Contact: Ritvik (G-5)"
 },
 "geometry": {
 "coordinates": [75.56190, 26.83985],
 "type": "Point"
 }
 }, {
 "type": "Feature",
 "properties": {
 "name": "Found Notebook",
 "category": "Lost & Found",
 "status": "Found on Aug 18",
 "hours": "Contact: Gargi (AB-2)"
 },
 "geometry": {
 "coordinates": [75.56480, 26.84350],
 "type": "Point"
 }
 }
 ]
 };

 // --- DATA CLEANING (IMPROVED) ---
 const cleanGeoJsonData = (data) => {
 // Trim whitespace from property keys AND values, and standardize key casing
 data.features.forEach(feature => {
 if (feature.properties) {
 const newProps = {};
 for (const key in feature.properties) {
 const cleanKey = key.trim().toLowerCase();
 const value = feature.properties[key];
 newProps[cleanKey] = typeof value === 'string' ? value.trim() : value;
 }
 feature.properties = newProps;
 }
 });

 // Re-index all features to ensure unique IDs
 data.features.forEach((feature, index) => {
 feature.id = index;
 });

 const polygonNames = new Set(
 data.features
 .filter(f => f.geometry.type === 'Polygon' && f.properties.name)
 .map(f => f.properties.name)
 );

 const cleanedFeatures = data.features.filter(feature => {
 if (!feature.properties.name) {
 return true;
 }
 // Filter out points that have a matching polygon
 if (feature.geometry.type === 'Point') {
 return !polygonNames.has(feature.properties.name);
 }
 return true;
 });

 return { ...data,
 features: cleanedFeatures
 };
 };
 const geojsonData = cleanGeoJsonData(rawGeojsonData);

 // --- MAP INITIALIZATION ---
const map = L.map('map').setView([26.8445, 75.5685], 16);

// 1. Define your map layers (basemaps)
const streetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});

const satelliteMap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
});

const darkMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
});

// 2. Set the default map layer
streetMap.addTo(map);

// 3. Create the baseMaps object for the control
const baseMaps = {
    "Streets": streetMap,
    "Satellite": satelliteMap,
    "Dark Mode": darkMap
};

// 4. Add the layer control to the map
L.control.layers(baseMaps).addTo(map);
 // --- GLOBAL VARIABLES ---
 let geojsonLayer;
 let routingControl;
 let searchPointer = null; // NEW: Variable for the search marker
 const searchInput = document.getElementById('searchInput');
 const searchResults = document.getElementById('searchResults');
 const categoryFilters = document.getElementById('categoryFilters');
 const infoPanel = document.getElementById('infoPanel');

 // --- FEATURE IMPLEMENTATION ---
 const setupLostAndFound = () => {
    const listElement = document.getElementById('lostAndFoundList');
    const lostAndFoundItems = geojsonData.features.filter(f => f.properties.category && f.properties.category.toLowerCase() === 'lost & found');
    if (lostAndFoundItems.length === 0) {
        listElement.innerHTML = '<p class="text-slate-500 text-sm">No items reported.</p>';
        return;
    }

    lostAndFoundItems.forEach(item => {
        const li = document.createElement('div');
        li.className = 'p-2 bg-white rounded-md shadow-sm cursor-pointer hover:bg-amber-50';
        li.innerHTML = `<p class="font-semibold text-slate-800">${item.properties.name}</p><p class="text-sm text-slate-600">${item.properties.status}</p>`;

        li.onclick = () => {
            const coords = item.geometry.coordinates;
            map.flyTo([coords[1], coords[0]], 18);

            geojsonLayer.eachLayer(layer => {
                if (layer.feature.id === item.id) {
                    layer.bindPopup(`<b>${item.properties.name}</b><br>${item.properties.hours}`).openPopup();
                }
            });
        };
        listElement.appendChild(li);
    });
};
 const createIcon = (color) => {
 return L.divIcon({
 html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${color}" class="w-8 h-8"><path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 005.16-4.212c1.558-2.24 2.365-4.68 2.365-7.182 0-5.168-4.192-9.36-9.36-9.36S2.18 5.75 2.18 10.92c0 2.502.807 4.942 2.365 7.182 1.558 2.24 3.245 3.865 5.16 4.212zM12 13.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" clip-rule="evenodd" /></svg>`,
 className: 'bg-transparent border-0',
 iconSize: [32, 32],
 iconAnchor: [16, 32],
 popupAnchor: [0, -32]
 });
 };
 
 
const categoryColors = {
 'academic': '#0f766e',
 'hostel': '#be123c',
 'dining': '#c2410c',
 'recreation': '#1d4ed8',
 'services': '#581c87',
 'events': '#854d0e',
 'sports': '#166534',
 'office': '#4a044e',
 'library': '#4a044e',
 'transport': '#7f1d1d',
 'parking': '#7f1d1d',
 'amenities': '#581c87',
 'passway': '#6b7280',
 'lost & found': '#581c87', // NEW
 'default': '#475569'
 };

 const getIconForCategory = (category) => {
 const cleanCategory = category ? category.toLowerCase() : 'default';
 return createIcon(categoryColors[cleanCategory] || categoryColors['default']);
};

 const updateInfoPanel = (properties) => {
 if (!properties || !properties.name) {
 infoPanel.style.display = 'none';
 infoPanel.classList.remove('info-panel-visible');
 return;
 }
 document.getElementById('infoName').textContent = properties.name;
 document.getElementById('infoCategory').textContent = properties.category || 'Landmark';
 document.getElementById('infoStatus').textContent = properties.status || 'N/A';
 document.getElementById('infoHours').textContent = properties.hours || 'N/A';
 infoPanel.style.display = 'block';
 setTimeout(() => infoPanel.classList.add('info-panel-visible'), 10);
 };

 const onEachFeature = (feature, layer) => {
 if (feature.properties && feature.properties.name) {
 layer.on('click', (e) => {
 updateInfoPanel(feature.properties);
 
 const endPoint = e.latlng;
 const waypoints = routingControl.getWaypoints();
 const startPoint = waypoints.length > 0 && waypoints[0].latLng ? waypoints[0].latLng : null;
 routingControl.setWaypoints([startPoint, endPoint]);

 if (layer.getBounds) {
 map.fitBounds(layer.getBounds());
 } else {
 map.flyTo(layer.getLatLng(), 17);
 }
 L.DomEvent.stopPropagation(e);
 });
 }
 };

 const loadGeoJSON = (filterCategory = 'All') => {
 if (geojsonLayer) map.removeLayer(geojsonLayer);
 geojsonLayer = L.geoJSON(geojsonData, {
 filter: (feature) => {
 if (filterCategory === 'All') return true;
 return feature.properties.category === filterCategory;
 },
 style: (feature) => {
 const type = feature.geometry.type;
 if (type === 'Polygon' || type === 'MultiPolygon') {
 const cleanCategory = feature.properties.category ? feature.properties.category.toLowerCase() : 'default';
 const color = categoryColors[cleanCategory] || categoryColors['default'];
 return { color: color, weight: 2, opacity: 0.8, fillColor: color, fillOpacity: 0.3 };
 }
 if (type === 'LineString' || type === 'MultiLineString') {
 return { color: '#4338ca', weight: 4, opacity: 0.7 };
 }
 },
 pointToLayer: (feature, latlng) => {
 return L.marker(latlng, {
 icon: getIconForCategory(feature.properties.category)
 });
 },
 onEachFeature: onEachFeature
 }).addTo(map);
 };

 searchInput.addEventListener('input', (e) => {
 const query = e.target.value.toLowerCase();
 searchResults.innerHTML = '';
 if (!query) return;
 const filtered = geojsonData.features.filter(f => f.properties.name && f.properties.name.toLowerCase().includes(query));
 filtered.forEach(feature => {
 const div = document.createElement('div');
 div.textContent = feature.properties.name;
 div.className = 'p-2.5 border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors';
 div.onclick = () => {
                // NEW: Pointer Logic Added
                if (searchPointer) {
                    map.removeLayer(searchPointer);
                }
                
 geojsonLayer.eachLayer(layer => {
                    // Match by unique ID for accuracy
                    if (layer.feature.id === feature.id) { 
                        const center = layer.getBounds ? layer.getBounds().getCenter() : layer.getLatLng();
                        const pointerIcon = createIcon('var(--primary-color)'); // Use the main amber color
                        searchPointer = L.marker(center, { icon: pointerIcon, zIndexOffset: 1000 }).addTo(map);
                        
                        // Trigger your original click functionality
                        layer.fire('click');
                    }
                });

 searchInput.value = feature.properties.name;
 searchResults.innerHTML = '';
 };
 searchResults.appendChild(div);
 });
 });

document.addEventListener('click', (e) => {
 if (!searchResults.contains(e.target) && e.target !== searchInput) searchResults.innerHTML = '';
 if (!e.target.closest('.leaflet-marker-icon') && !e.target.closest('.leaflet-interactive') && !infoPanel.contains(e.target)) {
 updateInfoPanel(null);
        // NEW: Cleanup pointer on map click
        if (searchPointer) {
            map.removeLayer(searchPointer);
            searchPointer = null;
        }
 }
 });

 const setupCategoryFilters = () => {
 const categories = ['All', ...new Set(geojsonData.features.filter(f => f.properties.category).map(f => f.properties.category))];
 const inactiveClasses = 'bg-slate-200 text-slate-700 hover:bg-slate-300';
 const activeClasses = 'bg-amber-500 text-white shadow font-semibold';

 categoryFilters.innerHTML = '';
 categories.forEach(category => {
 const button = document.createElement('button');
 button.textContent = category;
 button.className = 'px-3 py-1.5 text-sm rounded-full transition-all duration-300 transform hover:scale-105';
 button.classList.add(...(category === 'All' ? activeClasses : inactiveClasses).split(' '));
 button.onclick = () => {
 loadGeoJSON(category);
 document.querySelectorAll('#categoryFilters button').forEach(btn => {
 btn.className = btn.className.replace(activeClasses, inactiveClasses);
 });
 button.className = button.className.replace(inactiveClasses, activeClasses);
 };
 categoryFilters.appendChild(button);
 });
 };
 
 // --- ROUTING FUNCTION ---
 const setupRouting = () => {
 const clearRouteBtn = document.getElementById('clearRouteButton');

 routingControl = L.Routing.control({
 waypoints: [],
 routeWhileDragging: true,
 show: true,
 geocoder: null,
 createMarker: function(i, waypoint, n) {
 const color = i === 0 ? '#16a34a' : '#be123c'; // Green for start, Red for end
 return L.marker(waypoint.latLng, {
 draggable: true,
 icon: createIcon(color)
 });
 }
 }).addTo(map);

 routingControl.on('routesfound', function(e) {
 if (e.routes && e.routes.length > 0) {
 clearRouteBtn.style.display = 'block';
 } else {
 clearRouteBtn.style.display = 'none';
 }
 });

 clearRouteBtn.addEventListener('click', () => {
 routingControl.setWaypoints([]); // This clears the route and triggers 'routesfound'
        // NEW: Cleanup pointer when clearing route
        if (searchPointer) {
            map.removeLayer(searchPointer);
            searchPointer = null;
        }
 });
 
 document.getElementById('routeFromCurrentLocation').addEventListener('click', () => map.locate({
 setView: true,
 maxZoom: 16
 }));

 map.on('locationfound', (e) => {
 const startPoint = e.latlng;
 const waypoints = routingControl.getWaypoints();
 const endPoint = waypoints.length > 1 && waypoints[1].latLng ? waypoints[1].latLng : null;
 routingControl.setWaypoints([startPoint, endPoint]);
 });

 map.on('locationerror', (e) => {
 const infoPanel = document.getElementById('infoPanel');
 infoPanel.style.display = 'block';
 infoPanel.classList.add('info-panel-visible');
 document.getElementById('infoName').textContent = 'Location Error';
 document.getElementById('infoCategory').textContent = e.message;
 document.getElementById('infoStatus').textContent = '';
 document.getElementById('infoHours').textContent = '';
 });
 };

window.onload = () => {
       infoPanel.style.display = 'none';
    setupRouting(); 
    loadGeoJSON();
    setupCategoryFilters();
    setupLostAndFound(); // ADD THIS LINE

        // --- FINAL: SOS Button Logic with Clear Button ---
    const sosButton = document.getElementById('sosButton');
    const clearSosButton = document.getElementById('clearSosButton');
    let sosMarker = null; // To keep track of the red SOS marker

    sosButton.addEventListener('click', () => {
        if (!confirm('Are you sure you want to trigger the SOS? This will show your location for emergency reporting.')) {
            return;
        }

        alert('SOS Triggered! A notification has been sent to the campus security team with your location.');

        map.locate({
            setView: true,
            maxZoom: 18,
            enableHighAccuracy: true
        });

        map.once('locationfound', (e) => {
            const lat = e.latitude.toFixed(6);
            const lng = e.longitude.toFixed(6);
            
            if (sosMarker) {
                map.removeLayer(sosMarker);
            }

            sosMarker = L.marker(e.latlng, { icon: createIcon('#dc2626') }).addTo(map)
                .bindPopup('<b>YOUR CURRENT LOCATION</b><br>For Emergency Services')
                .openPopup();
            
            document.getElementById('infoName').textContent = 'EMERGENCY';
            document.getElementById('infoCategory').textContent = 'Your Location & Contacts';
            document.getElementById('infoStatus').innerHTML = `<b>Your Coordinates:</b><br>${lat}, ${lng}`;
            document.getElementById('infoHours').innerHTML = "<b>Campus Security:</b><br>+91 141-3999100";
            infoPanel.style.display = 'block';
            infoPanel.style.borderColor = '#dc2626';
            infoPanel.classList.add('info-panel-visible');

            sosButton.style.display = 'none';
            clearSosButton.style.display = 'block';
        });

        map.once('locationerror', (e) => {
            alert(`Could not get your location. Error: ${e.message}`);
        });
    });

    clearSosButton.addEventListener('click', () => {
        if (sosMarker) {
            map.removeLayer(sosMarker);
            sosMarker = null;
        }

        updateInfoPanel(null);
        infoPanel.style.borderColor = 'var(--primary-color)';

        clearSosButton.style.display = 'none';
        sosButton.style.display = 'flex';
    });
    };
 </script>
</body>
</html>
